name = "wishesu1"
main = "src/index.js"
compatibility_date = "2024-01-01"

[assets]
directory = "./public"
# Expose the static asset directory as the `ASSETS` binding.  With a Worker
# script present, Cloudflare still serves matching files automatically; however,
# binding the directory allows our worker to explicitly fetch assets and modify
# response headers when necessary.
binding = "ASSETS"

# Only invoke the Worker on dynamic paths.  Requests matching the patterns
# listed here will run through your Worker; all other requests will be served
# directly from the static assets directory without consuming CPU.  This
# dramatically reduces CPU usage for static content like CSS/JS/images and
# prebuilt HTML pages.
# Configure which requests should run through the Worker before checking
# for static assets.  The most specific patterns should be listed first,
# and patterns that are subsumed by broader patterns should be omitted to
# avoid Wrangler warnings.  Because `/admin/*` matches login/logout
# routes, separate patterns for `/admin/login*` and `/admin/logout*`
# are unnecessary and would be considered redundant by Wrangler.
run_worker_first = [
  "/api/*",          # All API routes
  "/blog/*",         # Dynamic blog post pages
  "/forum/*",        # Dynamic forum pages
  "/admin/*",        # Catch-all for all admin routes
  "/product*",       # Product pages and product grid
  "/download/*",     # Secure downloads
  "/robots.txt",     # Dynamic robots.txt
  "/sitemap.xml"     # Dynamic sitemap.xml
]

# Serve the nearest 404.html for unknown paths that don't match a static
# asset or Worker route.  Change to "single-page-application" if you have an SPA.
not_found_handling = "404-page"

[[d1_databases]]
binding = "DB"
database_name = "secure-shop-db"

[[r2_buckets]]
binding = "PRODUCT_MEDIA"
bucket_name = "product-media-bucket"

[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "temp-uploads-bucket"

[triggers]
# WARMING: Run every 3 minutes to keep worker and DB warm
# This prevents cold start issues and connection reset errors
# More frequent pings ensure the worker stays active
# Also runs cleanup at 2 AM daily
crons = ["*/1 * * * *", "0 2 * * *"]

# Optional build-time variables.  You can update VERSION before each publish
# to force Cloudflare to treat your worker and static assets as a new
# deployment.  This value is also surfaced via the /api/debug endpoint and
# attached to static asset responses via the X-Worker-Version header.  It can
# help confirm that you are receiving the latest build.
[vars]
VERSION = "22"
